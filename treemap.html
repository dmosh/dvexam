<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- iCheck -->
  <link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- JQVMap -->
  <link rel="stylesheet" href="plugins/jqvmap/jqvmap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
  <!-- summernote -->
  <link rel="stylesheet" href="plugins/summernote/summernote-bs4.min.css">
  <style>
    /* Add any custom styles here */
    .container {
      margin-top: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .chart {
      max-width: 100%;
      height: auto;
      margin: 0 auto;
    }

    #legend-container {
      text-align: center;
      margin-top: 20px;
      overflow-x: auto;
      white-space: nowrap;
    }

    .legend-item {
      display: inline-block;
      margin-right: 20px;
    }

    #legend {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .legend-item span {
      margin-left: 5px;
    }

  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

  <!-- Preloader -->
  <div class="preloader flex-column justify-content-center align-items-center">
    <img class="animation__shake" src="dist/img/AdminLTELogo.png" alt="AdminLTELogo" height="60" width="60">
  </div>

   <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link">
      <img src="dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">AdminLTE 3</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <!-- SidebarSearch Form -->
      <div class="form-inline">
        <div class="input-group" data-widget="sidebar-search">
          <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item menu-open">
            <a href="#" class="nav-link active">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Dashboard
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="./index.html" class="nav-link ">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Bar Chart</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="./index2.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Tree Chart</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="index3.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Coordinate Point Map</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="treemap.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Tree Map</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="scatter.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Scatter Plot</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="boxplot.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Box Plot</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="pages/radar.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Radar Chart</p>
                </a>
              </li>
            </ul>
          </li>         
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">Dashboard</h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active">Dashboard</li>
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-xs-12 col-sm-6 col-lg-12">
            <h2 id="chart-title"></h2>
            
          </div> 
        </div>                   
        </div>
        <div class="row">
          <div class="col-xs-12 col-sm-6 col-lg-12">
            <div id="filter-container">
              <label for="district-select">Select District:</label>
              <select id="district-select">
                <option value="all">All Districts</option>
              </select>
            </div>
            <div id="chart-container">
              <div class="chart" id="chart"></div>
            </div>
            <div id="legend-container">
              <h3>Legend:</h3>
              <div id="legend"></div>
            </div>
          </div>
        </div>
        <!-- /.row (main row) -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>
    All rights reserved.
    <div class="float-right d-none d-sm-inline-block">
      <b>Version</b> 3.2.0
    </div>
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    d3.csv("data/data.csv").then(function (data) {
      console.log(data); // Check if the data is loaded correctly

      // Data preprocessing
      const nestedData = d3.group(data, (d) => d.District);
      console.log(nestedData); // Check if the data is grouped correctly

      const districts = Array.from(nestedData.keys()); // Extract the district names

      // Add district options to the select element
      const districtSelect = d3.select("#district-select");
      districtSelect
        .selectAll("option")
        .data(districts)
        .enter()
        .append("option")
        .attr("value", (d) => d)
        .text((d) => d);

      // Chart dimensions
      const width = 1000;
      const height = 800;

      // Create a D3.js treemap layout
      const treemap = d3
        .treemap()
        .size([width, height])
        .padding(1);

      // Function to update the treemap based on the selected district
      function updateTreemap(selectedDistrict) {
        // Filter the data based on the selected district
        const filteredData =
          selectedDistrict === "all"
            ? data
            : data.filter((d) => d.District === selectedDistrict);

        const root = {
          name: "Uganda",
          children: Array.from(
            d3.group(filteredData, (d) => d.District),
            ([district, values]) => ({
              name: district,
              children: Array.from(values, (entry) => ({
                village: entry.village,
                ecoli: +entry.ecoli,
                ph: +entry.pH,
                conductivity: +entry["Electrical Conductivity"],
                turbidity: +entry.turbidity,
              })),
            })
          ),
        };

        // Compute the treemap layout
        const rootHierarchy = d3
          .hierarchy(root)
          .sum((d) => d.ecoli + d.ph + d.conductivity + d.turbidity)
          .sort((a, b) => b.value - a.value)
          .each(function (d) {
            d.name = d.parent ? d.parent.data.name : "Uganda"; // Assign district name or "Uganda" to each node
          });

        treemap(rootHierarchy);

        // Create the SVG container
        const svg = d3
          .select("#chart")
          .selectAll("svg")
          .data([null])
          .join("svg")
          .attr("viewBox", `0 0 ${width} ${height}`)
          .attr("preserveAspectRatio", "xMidYMid meet")
          .append("g")
          .attr("transform", "translate(0,0)");

        // Define an array of colors for districts
        const districtColors = d3.scaleOrdinal(d3.schemeCategory10);

        // Create the treemap nodes
        const node = svg
          .selectAll("g")
          .data(rootHierarchy.leaves())
          .join("g")
          .attr("transform", function (d) {
            return "translate(" + d.x0 + "," + d.y0 + ")";
          });

        node
          .append("rect")
          .attr("width", function (d) {
            return d.x1 - d.x0;
          })
          .attr("height", function (d) {
            return d.y1 - d.y0;
          })
          .attr("fill", function (d, i) {
            return d3.schemeCategory10[i % 10];
          })
          .attr("stroke", "white");

        // Define a linear gradient for the rectangle fill
        const gradient = node
          .append("linearGradient")
          .attr("id", function (d, i) {
            return "gradient-" + i;
          })
          .attr("gradientUnits", "userSpaceOnUse")
          .attr("x1", 0)
          .attr("y1", 0)
          .attr("x2", 1)
          .attr("y2", 1);

        gradient
          .append("stop")
          .attr("offset", "0%")
          .attr("stop-color", "white");

        gradient
          .append("stop")
          .attr("offset", "100%")
          .attr("stop-color", function (d) {
            const color = districtColors(d.parent.data.name);
            const darkerColor = d3.color(color).darker(0.8);
            return darkerColor.toString(); // Convert the color object back to string
          });

        node
          .append("rect")
          .attr("width", function (d) {
            return d.x1 - d.x0;
          })
          .attr("height", function (d) {
            return d.y1 - d.y0;
          })
          .attr("fill", function (d, i) {
            return "url(#gradient-" + i + ")"; // Apply the linear gradient
          })
          .attr("stroke", "white");

        node
          .append("clipPath")
          .attr("id", function (d, i) {
            return "clip-" + i;
          })
          .append("use")
          .attr("xlink:href", function (d, i) {
            return "#clip-" + i;
          })
          .attr("fill", "none");

        node
          .append("text")
          .attr("clip-path", function (d, i) {
            return "url(#clip-" + i + ")";
          })
          .selectAll("tspan")
          .data(function (d) {
            return (d.data.name || "").split(/(?=[A-Z][^A-Z])/g);
          })
          .join("tspan")
          .attr("x", 4)
          .attr("y", function (d, i) {
            return 13 + i * 10;
          })
          .text(function (d) {
            return d;
          });

        node
          .append("title")
          .text(function (d) {
            return (
              "District: " +
              d.parent.data.name +
              "\nVillage: " +
              d.data.village +
              "\nEcoli: " +
              d.data.ecoli +
              "\npH: " +
              d.data.ph +
              "\nTurbidity: " +
              d.data.turbidity
            );
          });

          // Update the legend
          const legend = d3.select("#legend");

          // Remove existing legend items
          legend.selectAll(".legend-item").remove();

          // Create new legend items
          const legendItems = legend
            .selectAll(".legend-item")
            .data(districts)
            .enter()
            .append("div")
            .attr("class", "legend-item");

          // Add colored squares to represent the districts
          legendItems
            .append("span")
            .style("display", "inline-block")
            .style("width", "12px")
            .style("height", "12px")
            .style("background-color", (d) => districtColors(d));

          // Add district names
          legendItems
            .append("span")
            .text((d) => d);
      }

      // Function to handle the select change event
      function handleSelectChange() {
        const selectedDistrict = districtSelect.property("value");
        updateTreemap(selectedDistrict);
      }

      // Event listener for select change event
      districtSelect.on("change", handleSelectChange);

      // Initial treemap update
      updateTreemap("all");
    });
  </script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@latest"></script>
<script src="plugins/jquery/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="plugins/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button)
</script>
<!-- Bootstrap 4 -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- ChartJS -->
<script src="plugins/chart.js/Chart.min.js"></script>
<!-- Sparkline -->
<script src="plugins/sparklines/sparkline.js"></script>
<!-- JQVMap -->
<script src="plugins/jqvmap/jquery.vmap.min.js"></script>
<script src="plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
<!-- jQuery Knob Chart -->
<script src="plugins/jquery-knob/jquery.knob.min.js"></script>
<!-- daterangepicker -->
<script src="plugins/moment/moment.min.js"></script>
<script src="plugins/daterangepicker/daterangepicker.js"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Summernote -->
<script src="plugins/summernote/summernote-bs4.min.js"></script>
<!-- overlayScrollbars -->
<script src="plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.js"></script>
</body>
</html>
